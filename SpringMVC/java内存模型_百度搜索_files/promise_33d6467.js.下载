define("@searchfe/promise/src/promise",["require","@searchfe/assert","@searchfe/promise/src/set-immediate"],function(e){function t(e){u(this instanceof t,"Promise must be called with new operator"),u("function"==typeof e,"callback not defined"),this._state=r,this._fulfilledCbs=[],this._rejectedCbs=[],this._errorPending=!1,this._fromResolver(e)}function n(e){u(e._state===s,c);var t;t="function"==typeof window.PromiseRejectionEvent?window.PromiseRejectionEvent:CustomEvent;var n=new t("unhandledrejection",{promise:e,reason:e._result});
return n.reason=n.reason||e._result,n}function i(e){return e&&"function"==typeof e.then}var r=0,o=1,s=2,c="cannot make RejectionEvent when promise not rejected",f={longStackTraces:!1},u=e("@searchfe/assert"),a=e("@searchfe/promise/src/set-immediate");return t.prototype._fulfill=function(e){this._result=e,this._state=o,this._flush()},t.prototype._reject=function(e){f.longStackTraces&&e&&(e.stack+="\n"+this._originalStack),this._result=e,this._state=s,this._errorPending=!0,this._flush(),a(function(){this._checkUnHandledRejection()
}.bind(this))},t.prototype._resolve=function(e){i(e)?this._fromResolver(e.then.bind(e)):this._fulfill(e)},t.prototype._fromResolver=function(e){var t=!1,n=this;try{e(function(e){t||(t=!0,n._resolve(e))},function(e){t||(t=!0,n._reject(e))})}catch(i){if(t)return;t=!0,n._reject(i)}},t.prototype._checkUnHandledRejection=function(){if(this._errorPending){var e=n(this);window.dispatchEvent(e)}},t.prototype._flush=function(){if(this._state!==r){var e=this._state===s?this._rejectedCbs:this._fulfilledCbs;
e.forEach(function(e){if(this._state===s&&this._errorPending&&(this._errorPending=!1),"function"==typeof e){var t=this._result;a(function(){e(t)})}},this),this._rejectedCbs=[],this._fulfilledCbs=[]}},t.prototype._done=function(e,t){this._fulfilledCbs.push(e),this._rejectedCbs.push(t),this._flush()},t.prototype.then=function(e,n){var i=this;return new t(function(t,r){var o;i._done(function(n){if("function"!=typeof e)return t(n);try{o=e(n)}catch(i){return r(i)}t(o)},function(e){if("function"!=typeof n)return r(e);
try{o=n(e)}catch(i){return r(i)}t(o)})})},t.prototype.catch=function(e){return this.then(function(e){return e},e)},t.prototype.finally=function(e){return this.then(e,e)},t.resolve=function(e){return e instanceof t?e:new t(function(t){return t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.all=function(e){return new t(function(n,i){function r(){0>=s&&n(o)}var o=e.map(function(){return void 0}),s=e.length;e.map(t.resolve).forEach(function(e,t){e.then(function(e){o[t]=e,s--,r()},i)}),r()
})},t.fromCallback=function(e){return new t(function(t){e(function(e){t(e)})})},t.mapSeries=function(e,n){var i,r=[];return 0===e.length?t.resolve(r):(e.forEach(function(o,s){i=i?t.resolve(i).then(function(){return n(o,s,e)}):t.resolve(n(o,s,e)),i=i.then(function(e){r.push(e)})}),i.then(function(){return r}))},t}),define("@searchfe/promise/src/set-immediate",["require"],function(){function e(e,t){var n=e.setImmediate;n(t)}function t(e,t){var n=e.setTimeout;n(t)}function n(e,t){var n=new e.MessageChannel;
n.port1.onmessage=function(){t()},n.port2.postMessage(c)}function i(e,t){e.addEventListener("message",function n(){e.removeEventListener("message",n,!1),t()},!1),e.postMessage(c,"*")}function r(r,o){f?t(r,o):r.setImmediate?e(r,o):r.MessageChannel?n(r,o):r.addEventListener&&r.postMessage?i(r,o):t(r,o)}function o(){return"undefined"!=typeof window?window:"undefined"!=typeof self?self:Function("return this")()}function s(e){var t=o();r(t,e)}var c="setImmediate polyfill",f=/baiduboxapp/.test(window.navigator.userAgent);
return s.impl=r,s}),define("@searchfe/promise",["@searchfe/promise/src/promise"],function(e){return e});